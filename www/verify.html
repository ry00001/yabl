<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Yet Another Bot List</title>
		<meta charset="utf-8"/>
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="/style.css">
	</head>
	<body>
			<div class="botcard" id="templateBotCard" style="display:none;">
					<div class="cardbotstatus"></div>
					<img class="cardimg" src=""/>
					<div class="cardbotinfo">
						<p class="cardheader subheader text">template</p>
						<p class="cardauthor metaheader text">template#0000</p>
						<p class="cardstats metaheader text">template Servers</p>
					</div>
					<p class="carddesc text">
						template
					</p>
					<div class="cardbuttons">
						<button id="invitebutton" class="inputbox cardbutton">Invite</button>
						<button id="supportbutton" class="inputbox cardbutton">Support</button>
					</div>
				</div>
		<div class="navbar">
			<div class="listitem home" onclick="home()">
				<div class="hover">
				</div>
				<p class="navtext text">YABL</p>
			</div>
			<div class="rightnav">
				<div class="listitem search">
					<input class="searchbox inputbox" placeholder="Search">
				</div>
				<div class="listitem login" onclick="login()">
					<div class="hover"></div>
					<p class="navtext text"><i class="fas fa-sign-in-alt"></i></p>
				</div>
				<div class="listitem logout" onclick="logout()">
					<div class="hover"></div>
					<p class="navtext text"><i class="fas fa-sign-out-alt"></i></p>
				</div>
				<div class="listitem addbot" onclick="addbot()">
          <div class="hover"></div>
          <p class="navtext text"><i class="fas fa-plus-circle"></i></p>
        </div>
        <div class="listitem verifynav" onclick="verify()">
          <div class="hover"></div>
          <p class="navtext text"><i class="fas fa-user-check"></i></p>
        </div>
				<div class="listitem profile" onclick="profile()">
					<div class="hover"></div>
					<p class="navtext text"><i class="fas fa-user-circle"></i></p>
				</div>
			</div>
		</div>
		<div class="pagecontent searchcontent">
			<div class="cardrow cardrowone" id="cardrowone">
			</div>
			<div class="cardrow cardrowtwo" id="cardrowtwo">
      </div>
      <div class="cardrow cardrowtwo" id="cardrowthree">
      </div>
      <div class="cardrow cardrowtwo" id="cardrowfour">
      </div>
      <div id="pagesdiv">
          <button class="inputbox searchbutton" id="previousbtn" onclick="previous()">Previous</button>
          <input class="inputbox searchbutton pagebox" id="pagein"></input>
          <button class="inputbox searchbutton" id="gobtn" onclick="go()">Go</button>
          <button class="inputbox searchbutton" id="nextbtn" onclick="next()">Next</button>
        <br/>
        <p class="footitem text" id="results"></p>
      </div>
		</div>
		<div class="footer">
			<p class="footitem text">&#169; YABL team 2018, built with java and html.</p>
			<p class="footitem text"><a href="/terms">Terms</a>|<a href="https://github.com/yabl-team">Github</a></p>
		</div>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script>
			var baseUrl = window.location.protocol +"//"+ window.location.hostname
			if(window.localStorage.getItem("token") != null){
			  document.querySelector(".listitem.login").style.display = "none"
			} else{
			  document.querySelector(".listitem.logout").style.display = "none"
			  document.querySelector(".listitem.addbot").style.display = "none"
			  document.querySelector(".listitem.profile").style.display = "none"
			}
      function findGetParameter(parameterName) {
                var result = null,
                    tmp = [];
                location.search
                    .substr(1)
                    .split("&")
                    .forEach(function (item) {
                    tmp = item.split("=");
                    if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
                    });
                return result;
            }
      var page = findGetParameter("page")||"0"
      var pages = 0
			var instance = axios.create({validateStatus: a => {return true;}});
      pagein.value = parseInt(page)+1
      function next(){
        var url = baseUrl + "/verify?page="+(parseInt(page)+1)
        window.location.href = url
      }
      function previous(){
        var url = baseUrl + "/verify?page="+(parseInt(page)-1)
        window.location.href = url
      }
      function go(){
        var url = baseUrl + "/verify?page="+Math.max(Math.min(parseInt(pagein.value)-1,pages),0)
        window.location.href = url
      }
      var whoami = null;
      if(localStorage.getItem("token") !== null){
        instance.get(baseUrl+"/api/whoami",{"headers":{"Content-Type":"application/json","Authorization":localStorage.getItem("token")}}).then(function(response){whoami = response.data
        if(whoami == null || !whoami.admin){
          window.location.href = baseUrl + "/401"
        }}).catch();
      }
      document.querySelector(".verifynav .hover").classList.add("active")
			instance.post(baseUrl + "/api/bots/unverified",{page:page},{"headers":{"Content-Type":"application/json","Authorization":localStorage.getItem("token")}})
			.then(function (response) {
			  var data = response.data
        pages = data.pages-1
        if(pages == -1) {
          nextbtn.setAttribute("style","display:none;")
          previousbtn.setAttribute("style","display:none;")
          gobtn.setAttribute("style","display:none;")
          pagein.setAttribute("style","display:none;")
          results.textContent = data.results + " Results, Page "+(parseInt(page)+1)+" of 1"
        } else{
          results.textContent = data.results + " Results, Page "+(parseInt(page)+1)+" of "+(parseInt(data.pages))
        }
        if(parseInt(page) == data.pages-1) nextbtn.setAttribute("style","display:none;")
        if(parseInt(page) == 0) previousbtn.setAttribute("style","display:none;")
			  for(var o in data.bots){
			    var i = data.bots[o]
			    if(o < 5){
						var card = document.getElementById("templateBotCard").cloneNode(true)
						card.id = "card"+i.id
						card.classList.add("card"+i.id)
						card.querySelector(".cardheader").textContent = i.username
						card.querySelector(".cardheader").setAttribute("onclick","window.location.href = 'https://yabl.xyz/bot/" + i.id + "'")
						card.querySelector(".cardauthor").textContent = i.owners[Object.keys(i.owners)[0]]
						card.querySelector(".cardauthor").setAttribute("onclick","window.location.href = 'https://yabl.xyz/user/" + Object.keys(i.owners)[0] + "'")
						card.querySelector(".cardstats").textContent = (i.guildCount||"No") + " Servers"
						card.querySelector(".carddesc").textContent = i.desc
						card.querySelector(".cardimg").src = "https://cdn.discordapp.com/avatars/"+i.id+"/"+i.avatar+".png?size=64"
						card.querySelector("#invitebutton").setAttribute("onclick", "window.open('https://discordapp.com/oauth2/authorize?client_id="+i.id+"&scope=bot','_blank')")
            card.querySelector("#supportbutton").setAttribute("onclick", "window.open('" + i.support + "','_blank')")
						card.style = "";

						document.getElementById("cardrowone").appendChild(card)
			    } else if(o < 10){
						var card = document.getElementById("templateBotCard").cloneNode(true)
						card.id = "card"+i.id
						card.classList.add("card"+i.id)
						card.querySelector(".cardheader").textContent = i.username
						card.querySelector(".cardheader").setAttribute("onclick","window.location.href = 'https://yabl.xyz/bot/" + i.id + "'")
						card.querySelector(".cardauthor").textContent = i.owners[Object.keys(i.owners)[0]]
						card.querySelector(".cardauthor").setAttribute("onclick","window.location.href = 'https://yabl.xyz/user/" + Object.keys(i.owners)[0] + "'")
						card.querySelector(".cardstats").textContent = (i.guildCount||"No") + " Servers"
						card.querySelector(".carddesc").textContent = i.desc
						card.querySelector(".cardimg").src = "https://cdn.discordapp.com/avatars/"+i.id+"/"+i.avatar+".png?size=64"
						card.style = "";
						document.getElementById("cardrowtwo").appendChild(card)
			    } else if(o < 15){
						var card = document.getElementById("templateBotCard").cloneNode(true)
						card.id = "card"+i.id
						card.classList.add("card"+i.id)
						card.querySelector(".cardheader").textContent = i.username
						card.querySelector(".cardheader").setAttribute("onclick","window.location.href = 'https://yabl.xyz/bot/" + i.id + "'")
						card.querySelector(".cardauthor").textContent = i.owners[Object.keys(i.owners)[0]]
						card.querySelector(".cardauthor").setAttribute("onclick","window.location.href = 'https://yabl.xyz/user/" + Object.keys(i.owners)[0] + "'")
						card.querySelector(".cardstats").textContent = (i.guildCount||"No") + " Servers"
						card.querySelector(".carddesc").textContent = i.desc
						card.querySelector(".cardimg").src = "https://cdn.discordapp.com/avatars/"+i.id+"/"+i.avatar+".png?size=64"
						card.style = "";
						document.getElementById("cardrowthree").appendChild(card)
			    } else if(o < 20){
						var card = document.getElementById("templateBotCard").cloneNode(true)
						card.id = "card"+i.id
						card.classList.add("card"+i.id)
						card.querySelector(".cardheader").textContent = i.username
						card.querySelector(".cardheader").setAttribute("onclick","window.location.href = 'https://yabl.xyz/bot/" + i.id + "'")
						card.querySelector(".cardauthor").textContent = i.owners[Object.keys(i.owners)[0]]
						card.querySelector(".cardauthor").setAttribute("onclick","window.location.href = 'https://yabl.xyz/user/" + Object.keys(i.owners)[0] + "'")
						card.querySelector(".cardstats").textContent = (i.guildCount||"No") + " Servers"
						card.querySelector(".carddesc").textContent = i.desc
						card.querySelector(".cardimg").src = "https://cdn.discordapp.com/avatars/"+i.id+"/"+i.avatar+".png?size=64"
						card.style = "";
						document.getElementById("cardrowfour").appendChild(card)
			    }
			  }
        if(data.bots.length <= 5){
            cardrowtwo.style = "display:none;"
            cardrowthree.style = "display:none;"
            cardrowfour.style = "display:none;"
          } else if(data.bots.length <= 10){
            cardrowthree.style = "display:none;"
            cardrowfour.style = "display:none;"
          } else if(data.bots.length <= 15){
            cardrowfour.style = "display:none;"
            
          }
			}).catch(function (error) {console.log(error)});
			function login(){
			  window.location.href = baseUrl + "/login";
			}
			function logout(){
			  window.localStorage.removeItem("token");
			  window.location.reload();
			}
			function addbot(){
			  window.location.href = baseUrl + "/add";
			}
			function profile(){
			  window.location.href = baseUrl + "/dashboard";
			}
      function verify(){
			  window.location.href = baseUrl + "/verify";
			}
      function home(){
        window.location.href = baseUrl;
      }
			function calcFontSize(username){
				var factors = [0,2,2,2.2,2.15,2.05,1.95,1.85,1.78,1.68,1.61,1.55,1.51,1.44,1.38,1.33,1.28,1.24,1.2,1.16,1.12,1.08,1]
				return (35-(Math.max(username.length-11,0)*factors[Math.max(username.length-11,0)]))
			}
			document.querySelector(".searchbox").addEventListener("keyup", function(event) {
			  event.preventDefault();
			  if (event.keyCode === 13) {
			    window.location.href = baseUrl + "/search?query="+encodeURI(document.querySelector(".searchbox").value);
			  }
			});
		</script>
	</body>
</html>