<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Yet Another Bot List</title>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="./style.css">
    </head>
    <body>
        <div class="navbar">
            <div class="rightnav">
                
            </div>
        </div>
        <div class="pagecontent addcontent">
            <div class="addleftdiv">
                <input class="inputbox pageinput addinput botid" nothing="Bot ID*"><br/>
                <input class="inputbox pageinput addinput prefix" nothing="Prefix*"><br/>
                <input class="inputbox pageinput addinput help" nothing="Help Command*"><br/>
                <input class="inputbox pageinput addinput desc" nothing="Description*"><br/>
                <input class="inputbox pageinput addinput website" nothing="Website"><br/>
                <input class="inputbox pageinput addinput support" nothing="Support Server"><br/>
                <input class="inputbox pageinput addinput git" nothing="Git Repository"><br/>
                <input class="inputbox pageinput addinput library" nothing="Library"><br/>
                <input class="inputbox pageinput addinput modnote" nothing="Moderator Note"><br/>
                <button class="inputbox pageinput addinput submit" onclick="submit()">Submit</button>
            </div>
            <div class="inputbox pageinput addinput body">
                <textarea class="nestedinput" nothing="Body (markdown)*"></textarea>
            </div>
            <p class="errors"></p>
        </div>
        <div class="footer">
            <p class="footitem text">footer stuff</p>
        </div>
        <script>
            var baseUrl = window.location.protocol +"//"+ window.location.hostname
            if(window.localStorage.getItem("token") != null){
              document.querySelector(".listitem.login").style.display = "none"
            } else{
              document.querySelector(".listitem.logout").style.display = "none"
              document.querySelector(".listitem.addbot").style.display = "none"
              document.querySelector(".listitem.profile").style.display = "none"
            }
            document.querySelector(".addbot .hover").classList.add("active")
            function login(){
              window.location.href = baseUrl + "/login";
            }
            function logout(){
              window.localStorage.removeItem("token");
              window.location.reload();
            }
            function addbot(){
              window.location.href = baseUrl + "/add";
            }
            function profile(){
              window.location.href = baseUrl + "/dashboard";
            }
            function home(){
                window.location.href = baseUrl;
            }
            function submit(){
                if(document.querySelector(".botid").value.length < 17 || document.querySelector(".prefix").value.length < 1 || document.querySelector(".help").value.length < 2 || 
                    document.querySelector(".desc").value.length < 30 || document.querySelector(".nestedinput").value.length < 100){
                    document.querySelector(".errors").innerHTML = ""; 
                    if(document.querySelector(".botid").value.length < 17){
                        document.querySelector(".errors").innerHTML = `Bot ID is too short. (${document.querySelector(".botid").value.length}/17)</br>`
                    }
                    if(document.querySelector(".prefix").value.length < 1){
                        document.querySelector(".errors").innerHTML = document.querySelector(".errors").innerHTML + `Prefix is too short. (${document.querySelector(".prefix").value.length}/1)</br>`
                    }
                    if(document.querySelector(".help").value.length < 2){
                        document.querySelector(".errors").innerHTML = document.querySelector(".errors").innerHTML + `Help command is too short. (${document.querySelector(".help").value.length}/2)</br>`
                    }
                    if(document.querySelector(".desc").value.length < 30){
                        document.querySelector(".errors").innerHTML = document.querySelector(".errors").innerHTML + `Description is too short. (${document.querySelector(".desc").value.length}/30)</br>`
                    }
                    if(document.querySelector(".nestedinput").value.length < 100){
                        document.querySelector(".errors").innerHTML = document.querySelector(".errors").innerHTML + `Body is too short. (${document.querySelector(".botid").value.length}/100)</br>`
                    }
                } else{
                    var object = {};
                    object["id"] = document.querySelector(".botid").value
                    object["prefix"] = document.querySelector(".prefix").value
                    object["help"] = document.querySelector(".help").value 
                    object["desc"] = document.querySelector(".desc").value
                    object["body"] = document.querySelector(".nestedinput").value
                    document.querySelector(".website").value.length > 0 ? object["website"] = document.querySelector(".website").value : false;
                    document.querySelector(".support").value.length > 0 ? object["support"] = document.querySelector(".support").value : false;
                    document.querySelector(".git").value.length > 0 ? object["git"] = document.querySelector(".git").value : false;
                    document.querySelector(".library").value.length > 0 ? object["library"] = document.querySelector(".library").value : false;
                    document.querySelector(".modnote").value.length > 0 ? object["modnote"] = document.querySelector(".modnote").value : false;
                    var instance = axios.create({validateStatus: a => {return true;}});
                    instance.post(baseUrl + "/api/bot/"+object["id"]+"/add",object,{"headers":{"Content-Type":"application/json","Authorization":localStorage.getItem("token")}})
                    .then(function (response) {
                        if(response.status == 201){

                        } else{
                            document.querySelector(".errors").innerHTML = response.status + "<br/>";
                            document.querySelector(".errors").innerHTML = document.querySelector(".errors").innerHTML + response.data
                        }
                    })
                    .catch(function (error) {
                        document.querySelector(".errors").innerHTML = response.status + "<br/>";
                        document.querySelector(".errors").innerHTML = document.querySelector(".errors").innerHTML + response.data
                    });
                }
            }
            document.querySelector(".searchbox").addEventListener("keyup", function(event) {
              event.preventDefault();
              if (event.keyCode === 13) {
                window.location.href = baseUrl + "/search?query="+encodeURI(document.querySelector(".searchbox").value);
              }
            });
        </script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    </body>
</html>